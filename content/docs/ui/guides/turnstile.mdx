---
title: "Cloudflare Turnstile"
description: "Guide to using Cloudflare Turnstile"
highlight: true
---

import { Step, Steps } from "fumadocs-ui/components/steps";
import { Example } from "@/components/example";
import { Turnstile } from "@/registry/v2/ui/turnstile";
import { TypeTable } from "fumadocs-ui/components/type-table";


Turnstile is Cloudflare's smart CAPTCHA replacement that validates users without solving puzzles, respects user privacy (no tracking across sites), works seamlessly with modern web applications, and provides enterprise-grade bot protection. Cloudflare Turnstile needs two siteKey and secretKey. You can get those in https://www.cloudflare.com/application-services/products/turnstile/. 

## How It Works

- **Client-side**: User interacts with the Turnstile widget, which generates a token
- **Form submission**: Token is sent to your server along with form data
- **Server-side verification**: Your backend validates the token with Cloudflare's API
- **Response**: Process the form only if verification succeeds






## Installation 

<Steps>
    <Step>
        **Install dependencies**

        ```bash
        npm install @marsidev/react-turnstile
        ```
    </Step>
    <Step>
        **Create the component file**
        
        ```bash
        touch src/components/ui/turnstile.tsx
        ```
    </Step>
    <Step>
        **Copy & paste the component source code**

        <include cwd lang="tsx" meta='title="components/ui/turnstile.tsx"'>
          src/registry/v2/ui/turnstile.tsx
        </include>
        
        Update the import paths to match your project setup.
    </Step>
    
    <Step>
        **Create a the verification utility file**

        ```bash
        touch src/lib/turnstile.ts
        ```
    </Step>
     <Step>
        **Copy & paste the source code**

        <include cwd lang="tsx" meta='title="lib/turnstile.ts"'>
          src/registry/v2/ui/turnstile.ts
        </include>
    </Step>
    
    <Step>
        **Add environment variables to your .env.local file**
        c
        ```bash
        NEXT_PUBLIC_TURNSTILE_SITE_KEY=your_site_key_here
        TURNSTILE_SECRET_KEY=your_secret_key_here
        ```
        
    </Step>
</Steps>


## Example using React Hook Form

```tsx
import { Turnstile } from '@/components/ui/turnstile'

```

```tsx
<Turnstile
 ref={turnstileRef}
 onSuccess={(token: string) => field.handleChange(token)}
 onError={() => field.handleChange("")}
 onExpire={() => field.handleChange("")}
/>
 ```


```tsx
import { verifyTurnstileToken, getClientIP } from "@/lib/turnstile";


type ContactFormData = {
  ...
  turnstileToken: string;
};


export async function POST(request: NextRequest) {
  try {
    const body: ContactFormData = await request.json();
    const { name, ... , turnstileToken } = body;

    if (!name || ... || !turnstileToken) {
      return NextResponse.json(
        { error: "All fields are required and you must agree to the processing of personal data." },
        { status: 400 }
      );
    }

    // Verify Turnstile token
    const clientIP = getClientIP(request);
    const turnstileResult = await verifyTurnstileToken(turnstileToken, clientIP);

    if (!turnstileResult.success) {
      return NextResponse.json(
        { error: turnstileResult.error || "Verification failed. Please try again." },
        { status: 400 }
      );
    }

    return NextResponse.json({ message: "Message sent successfully!" }, { status: 200 });
  } catch (error) {
    console.error("Error sending email:", error);
    return NextResponse.json(
      { error: "An error occurred while sending the message. Please try again later." },
      { status: 500 }
    );
  }
}
```


## Component API Reference

### Turnstile Props

<TypeTable
  type={{
    onSuccess: {
      description: "Callback when verification succeeds. Receives the token to submit to your backend.",
      type: "(token: string) => void",
    },
    onError: {
      description: "Callback when verification fails. Clear the token state here.",
      type: "() => void",
    },
    onExpire: {
      description: "Callback when token expires (after ~5 minutes). Clear the token state.",
      type: "() => void",
    },
    className: {
      description: "Optional CSS classes for custom styling",
      type: "string",
    },
    ref: {
      description: "Ref to access widget methods like reset()",
      type: "React.Ref<TurnstileRef>",
    },
  }}
/>
